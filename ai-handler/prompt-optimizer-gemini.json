{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "name": "PromptOptimizer",
  "version": "1.0.0",
  "description": "Automatic prompt enhancement for GeminiCLI",

  "config": {
    "enabled": true,
    "autoOptimize": true,
    "showEnhancements": false,
    "minClarityThreshold": 60,
    "maxPromptLength": 32000,
    "cacheEnabled": true,
    "cacheTTLSeconds": 3600
  },

  "categories": {
    "code": {
      "keywords": ["write", "implement", "create function", "code", "script", "program", "fix bug", "debug", "refactor", "class", "method"],
      "enhancers": [
        "Provide clean, well-documented code.",
        "Include error handling where appropriate.",
        "Follow best practices for the language.",
        "Add type hints/annotations if applicable."
      ],
      "systemPrompt": "You are an expert programmer. Write clean, efficient, and well-documented code.",
      "temperature": 0.3,
      "topP": 0.9
    },
    "analysis": {
      "keywords": ["analyze", "compare", "explain", "evaluate", "assess", "review", "examine", "investigate"],
      "enhancers": [
        "Provide a structured analysis.",
        "Consider multiple perspectives.",
        "Support conclusions with reasoning.",
        "Use clear headings and sections."
      ],
      "systemPrompt": "You are an analytical expert. Provide thorough, balanced analysis with clear reasoning.",
      "temperature": 0.5,
      "topP": 0.95
    },
    "question": {
      "keywords": ["what is", "how does", "why", "when", "where", "who", "which", "?", "explain"],
      "enhancers": [
        "Be concise but thorough.",
        "Provide examples if helpful.",
        "Start with a direct answer."
      ],
      "systemPrompt": "Provide clear, accurate, and helpful answers.",
      "temperature": 0.4,
      "topP": 0.9
    },
    "creative": {
      "keywords": ["write story", "generate", "brainstorm", "imagine", "creative", "ideas", "invent"],
      "enhancers": [
        "Be creative and original.",
        "Explore unique angles.",
        "Think outside the box."
      ],
      "systemPrompt": "You are a creative writer. Be imaginative and original.",
      "temperature": 0.9,
      "topP": 0.98
    },
    "task": {
      "keywords": ["do", "execute", "run", "perform", "make", "build", "setup", "configure", "install"],
      "enhancers": [
        "Provide step-by-step instructions.",
        "Include verification steps.",
        "Mention prerequisites if any."
      ],
      "systemPrompt": "Provide clear, actionable instructions.",
      "temperature": 0.3,
      "topP": 0.9
    },
    "summary": {
      "keywords": ["summarize", "summary", "brief", "tldr", "overview", "recap", "condense"],
      "enhancers": [
        "Be concise - focus on key points.",
        "Use bullet points for clarity.",
        "Prioritize most important information."
      ],
      "systemPrompt": "Provide concise, well-organized summaries.",
      "temperature": 0.3,
      "topP": 0.85
    }
  },

  "languageDetection": {
    "python": {
      "keywords": ["python", "py", "pip", "pandas", "numpy", "django", "flask", "pytorch", "tensorflow"],
      "fileExtensions": [".py", ".pyw", ".pyi"],
      "prefix": "[Python] "
    },
    "javascript": {
      "keywords": ["javascript", "js", "node", "npm", "react", "vue", "angular", "express", "next.js"],
      "fileExtensions": [".js", ".mjs", ".cjs"],
      "prefix": "[JavaScript] "
    },
    "typescript": {
      "keywords": ["typescript", "ts", "tsx", "deno"],
      "fileExtensions": [".ts", ".tsx", ".mts"],
      "prefix": "[TypeScript] "
    },
    "rust": {
      "keywords": ["rust", "cargo", "rustc", "tokio", "async-std"],
      "fileExtensions": [".rs"],
      "prefix": "[Rust] "
    },
    "go": {
      "keywords": ["golang", "go ", "goroutine"],
      "fileExtensions": [".go"],
      "prefix": "[Go] "
    },
    "java": {
      "keywords": ["java ", "jvm", "maven", "gradle", "spring", "kotlin"],
      "fileExtensions": [".java", ".kt"],
      "prefix": "[Java] "
    },
    "csharp": {
      "keywords": ["c#", "csharp", "dotnet", ".net", "aspnet", "unity"],
      "fileExtensions": [".cs"],
      "prefix": "[C#] "
    },
    "sql": {
      "keywords": ["sql", "query", "select", "database", "mysql", "postgres", "sqlite", "mongodb"],
      "fileExtensions": [".sql"],
      "prefix": "[SQL] "
    },
    "bash": {
      "keywords": ["bash", "shell", "sh ", "linux", "terminal", "cli"],
      "fileExtensions": [".sh", ".bash"],
      "prefix": "[Bash] "
    },
    "powershell": {
      "keywords": ["powershell", "ps1", "pwsh", "cmdlet"],
      "fileExtensions": [".ps1", ".psm1", ".psd1"],
      "prefix": "[PowerShell] "
    }
  },

  "clarityAnalysis": {
    "vagueWords": {
      "words": ["something", "stuff", "thing", "it", "this", "that", "etc", "whatever", "somehow"],
      "penalty": 5
    },
    "specificityIndicators": {
      "words": ["specifically", "exactly", "must", "should", "using", "with", "in", "for"],
      "bonus": 3
    },
    "minLength": {
      "threshold": 10,
      "penalty": 30
    },
    "shortLength": {
      "threshold": 30,
      "penalty": 15
    },
    "contextPattern": {
      "regex": "(for|to|because|since|using|with|in)\\s+\\w+",
      "missingPenalty": 10
    },
    "formatPattern": {
      "regex": "(format|output|return|show|display|as|like)",
      "suggestion": "Consider specifying desired output format"
    }
  },

  "modelOptimizations": {
    "gemini-2.0-flash": {
      "maxTokens": 8192,
      "style": "balanced",
      "prefix": "",
      "temperature": 0.7,
      "topP": 0.95
    },
    "gemini-2.0-flash-lite": {
      "maxTokens": 4096,
      "style": "concise",
      "prefix": "",
      "temperature": 0.5,
      "topP": 0.9
    },
    "gemini-1.5-pro": {
      "maxTokens": 32768,
      "style": "detailed",
      "prefix": "",
      "temperature": 0.7,
      "topP": 0.95
    },
    "gemini-1.5-flash": {
      "maxTokens": 8192,
      "style": "balanced",
      "prefix": "",
      "temperature": 0.6,
      "topP": 0.9
    }
  },

  "templates": {
    "structureWrapper": {
      "lowClarity": "Task: {prompt}\n\nPlease provide a clear, well-structured response.",
      "codeRequest": "## Request\n{prompt}\n\n## Requirements\n- Clean, readable code\n- Proper error handling\n- Comments for complex logic",
      "analysisRequest": "## Topic\n{prompt}\n\n## Analysis Requirements\n- Structured approach\n- Multiple perspectives\n- Evidence-based conclusions"
    },
    "fewShotFormat": {
      "header": "\n\nExamples of good responses:\n",
      "example": "Q: {question}\nA: {answer}\n\n"
    }
  },

  "hooks": {
    "preProcess": [
      {
        "name": "trimWhitespace",
        "enabled": true
      },
      {
        "name": "normalizeNewlines",
        "enabled": true
      },
      {
        "name": "removeExcessivePunctuation",
        "enabled": false
      }
    ],
    "postProcess": [
      {
        "name": "validateEnhancement",
        "enabled": true,
        "maxLengthIncrease": 2.0
      }
    ]
  },

  "api": {
    "endpoints": {
      "optimize": "/api/prompt/optimize",
      "analyze": "/api/prompt/analyze",
      "batch": "/api/prompt/batch"
    },
    "methods": {
      "optimize": {
        "input": {
          "prompt": "string",
          "model": "string?",
          "category": "string?",
          "addExamples": "boolean?",
          "detailed": "boolean?"
        },
        "output": {
          "originalPrompt": "string",
          "optimizedPrompt": "string",
          "category": "string",
          "language": "string?",
          "clarityScore": "number",
          "enhancements": "string[]",
          "wasEnhanced": "boolean"
        }
      },
      "analyze": {
        "input": {
          "prompt": "string"
        },
        "output": {
          "score": "number",
          "quality": "string",
          "issues": "string[]",
          "suggestions": "string[]",
          "category": "string",
          "detectedLanguage": "string?"
        }
      }
    }
  },

  "geminiIntegration": {
    "safetySettings": [
      {
        "category": "HARM_CATEGORY_HARASSMENT",
        "threshold": "BLOCK_MEDIUM_AND_ABOVE"
      },
      {
        "category": "HARM_CATEGORY_HATE_SPEECH",
        "threshold": "BLOCK_MEDIUM_AND_ABOVE"
      },
      {
        "category": "HARM_CATEGORY_SEXUALLY_EXPLICIT",
        "threshold": "BLOCK_MEDIUM_AND_ABOVE"
      },
      {
        "category": "HARM_CATEGORY_DANGEROUS_CONTENT",
        "threshold": "BLOCK_MEDIUM_AND_ABOVE"
      }
    ],
    "generationConfig": {
      "candidateCount": 1,
      "stopSequences": [],
      "responseMimeType": "text/plain"
    },
    "systemInstructionTemplate": "{categorySystemPrompt}\n\nUser request optimization applied: {enhancements}"
  },

  "cli": {
    "commands": {
      "optimize": {
        "alias": ["opt", "enhance"],
        "description": "Optimize a prompt before sending",
        "usage": "gemini optimize \"your prompt here\"",
        "flags": {
          "--model": "Target model for optimization",
          "--category": "Force specific category",
          "--show": "Show optimization details",
          "--no-optimize": "Disable auto-optimization",
          "--examples": "Include few-shot examples"
        }
      },
      "analyze": {
        "alias": ["check", "quality"],
        "description": "Analyze prompt quality without optimizing",
        "usage": "gemini analyze \"your prompt here\""
      }
    },
    "environment": {
      "GEMINI_AUTO_OPTIMIZE": {
        "type": "boolean",
        "default": true,
        "description": "Enable automatic prompt optimization"
      },
      "GEMINI_SHOW_ENHANCEMENTS": {
        "type": "boolean",
        "default": false,
        "description": "Show optimization details in output"
      },
      "GEMINI_MIN_CLARITY": {
        "type": "number",
        "default": 60,
        "description": "Minimum clarity score to trigger enhancement"
      }
    }
  },

  "examples": {
    "basic": {
      "input": "python sort",
      "output": "[Python] python sort\n\nProvide clean, well-documented code. Include error handling where appropriate. Follow best practices for the language.",
      "category": "code",
      "clarityScore": 45,
      "enhancements": ["Added language tag: python", "Added code-specific instructions"]
    },
    "analysis": {
      "input": "compare react vue",
      "output": "compare react vue\n\nProvide a structured analysis. Consider multiple perspectives. Support conclusions with reasoning. Use clear headings and sections.",
      "category": "analysis",
      "clarityScore": 55,
      "enhancements": ["Added analysis-specific instructions"]
    },
    "lowClarity": {
      "input": "do the thing",
      "output": "Task: do the thing\n\nPlease provide a clear, well-structured response.\n\nProvide step-by-step instructions. Include verification steps. Mention prerequisites if any.",
      "category": "task",
      "clarityScore": 25,
      "enhancements": ["Added structure wrapper", "Added task-specific instructions"]
    }
  }
}
